<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to mixmustr • mixmustr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to mixmustr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mixmustr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to mixmustr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/open-aims/mixmustr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to mixmustr</h1>
                        <h4 data-toc-skip class="author">Diego Barneche
and Chris Fulton</h4>
            
            <h4 data-toc-skip class="date">2025-06-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/open-aims/mixmustr/blob/main/vignettes/introduction.Rmd" class="external-link"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>mixmustr</code> is a flexible Bayesian mixture model package
written in the probabilistic programming language <a href="https://mc-stan.org/" class="external-link">Stan</a> for <a href="https://www.r-project.org/" class="external-link">R</a>. It estimates source mixing
proportions by incorporating simultaneous likelihood evaluation from two
independent data streams collected from the mixture of interest:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Chemical tracers/biomarkers</strong> (e.g., stable isotopes,
fatty acids).</li>
<li>
<strong>Source composition</strong> (e.g., based on eDNA or
metabarcoding).</li>
</ol>
<p><code>mixmustr</code> also allows for the estimation of an
additional, unsampled source component to partially relax the assumption
that the mixing proportions from all sampled sources should sum to 1.
This makes it particularly useful in ecological studies, such as
understanding carbon source-sink dynamics or trophic interactions.</p>
<p align="center">
<img src="../reference/figures/diagram.png" width="800/"></p>
<p><strong>Figure 1:</strong> <code>mixmustr</code> input data and
framework.</p>
<p>This vignette will walk you through the basic usage of
<code>mixmustr</code>, covering:</p>
<ul>
<li>Preparing input data</li>
<li>Running multiple model configurations</li>
<li>Visualizing model fit</li>
</ul>
<div class="section level3">
<h3 id="model-variants">Model Variants<a class="anchor" aria-label="anchor" href="#model-variants"></a>
</h3>
<p><code>mixmustr</code> provides eight model variants based on three
user-driven binary choices:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Tracer signature error structure</strong>:
<ul>
<li>Residual-only error (similar to MixSIAR).</li>
<li>Process error (incorporates uncertainty in tracer signatures).</li>
</ul>
</li>
<li>
<strong>Unsampled-source tracer signatures</strong>:
<ul>
<li>Fixed at the mean across sampled sources.</li>
<li>Estimated using a prior informed by sampled tracer signatures.</li>
</ul>
</li>
<li>
<strong>Observation independence</strong>:
<ul>
<li>Independent observations.</li>
<li>Hierarchical grouping structure.</li>
</ul>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="synthetic-datasets-in-mixmustr">Synthetic Datasets in <code>mixmustr</code><a class="anchor" aria-label="anchor" href="#synthetic-datasets-in-mixmustr"></a>
</h3>
<p>The <code>mixmustr</code> package includes two synthetic mixture
datasets, <code>synthetic_df_convergent</code> and
<code>synthetic_df_divergent</code>, designed for testing and validation
purposes. Both datasets are anchored to empirical values of stable
isotopes and fatty acids from plant carbon sources in marine soils and
simulate a hierarchical, unbalanced ecological field sampling
design.</p>
<ul>
<li>
<strong><code>synthetic_df_convergent</code></strong>: Exhibits
minimal differences in the underlying mixing proportions between data
streams 1 and 2.</li>
<li>
<strong><code>synthetic_df_divergent</code></strong>: Exhibits
significant differences in the underlying mixing proportions between
data streams 1 and 2.</li>
</ul>
<p>Each dataset is a list containing three data frames: 1.
<strong><code>df_stream_1</code></strong>: Simulated mixture data for
the first stream, including tracer estimates. 2.
<strong><code>df_stream_2</code></strong>: Synthetic proportions for the
second stream, with a column for each source. 3.
<strong><code>stream_1_props</code></strong>: Synthetic proportions for
the first stream, used for testing purposes.</p>
<p>These datasets were generated using the internal
<code>make_mixture_data</code> function, which combines stable isotope
data (<code>bcs_si</code>), fatty acid data (<code>bcs_fa</code>), and
synthetic proportions. The <code>truth_stream</code> parameter specifies
the stream used as the “true” source contributions. These datasets are
valuable for evaluating the ability of model variants to retrieve
underlying mixture proportions, with diagnostic tools available for
summary and visualization.</p>
</div>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>We begin by loading the package and setting options for parallel
computing and Stan:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://open-aims.github.io/mixmustr/" class="external-link">mixmustr</a></span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="step-1-prepare-tracer-parameters">Step 1: Prepare Tracer Parameters<a class="anchor" aria-label="anchor" href="#step-1-prepare-tracer-parameters"></a>
</h3>
<p>We’ll assume you have access to source tracer summaries—mean
(<code>mus</code>) and standard deviation (<code>sigmas</code>) values
for each source.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mus</span> <span class="op">&lt;-</span> <span class="va">tracer_parameters</span><span class="op">$</span><span class="va">mus</span></span>
<span><span class="va">sigmas</span> <span class="op">&lt;-</span> <span class="va">tracer_parameters</span><span class="op">$</span><span class="va">sigmas</span></span></code></pre></div>
<p>These are required to inform the model about each source’s chemical
signature and the variability around it.</p>
<hr>
</div>
<div class="section level3">
<h3 id="step-2-run-the-models">Step 2: Run the Models<a class="anchor" aria-label="anchor" href="#step-2-run-the-models"></a>
</h3>
<p>The core function to run models is
<code><a href="../reference/run_mixmustr_models.html">run_mixmustr_models()</a></code>. This function allows you to run
multiple models defined in the built-in <code>mixmustr_models</code>
data frame.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mixmustr_models.html">run_mixmustr_models</a></span><span class="op">(</span></span>
<span>  <span class="va">mixmustr_models</span><span class="op">[</span><span class="fl">6</span>, <span class="op">]</span>, <span class="va">synthetic_df_convergent</span>, <span class="va">mus</span>, <span class="va">sigmas</span>,</span>
<span>  sigma_ln_rho <span class="op">=</span> <span class="fl">0.1</span>, iter <span class="op">=</span> <span class="fl">1e4</span>, warmup <span class="op">=</span> <span class="fl">5e3</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="behind-the-scenes">Behind the Scenes<a class="anchor" aria-label="anchor" href="#behind-the-scenes"></a>
</h4>
<p>This function:</p>
<ul>
<li>Uses the tracer means (<code>mus</code>) and standard deviations
(<code>sigmas</code>)</li>
<li>Reads your observed data (<code>synthetic_df_convergent</code>)</li>
<li>Applies each model configuration in
<code>mixmustr_models</code>
</li>
<li>Internally calls <code><a href="../reference/mixmustr_wrangle_input.html">mixmustr_wrangle_input()</a></code> to prepare
each dataset for Stan</li>
<li>Returns a list of results, one per model configuration</li>
</ul>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="step-3-visualize-model-fit">Step 3: Visualize Model Fit<a class="anchor" aria-label="anchor" href="#step-3-visualize-model-fit"></a>
</h3>
<p>Once a model is fit, you can visualize the performance using the
built-in plotting tools.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/make_post_prop_long.html">make_post_prop_long</a></span><span class="op">(</span></span>
<span>  <span class="va">model_fits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">model</span>, <span class="va">mus</span>, <span class="va">synthetic_df_convergent</span>, target <span class="op">=</span> <span class="st">"df_stream_2"</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_multiple_faceted_scatter_avg.html">plot_multiple_faceted_scatter_avg</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Observed (simulated) from eDNA (data stream 2)"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Model fit performance mixing proportions"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Synthetic dataset of high agreement"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<embed src="vignette-fig-unnamed-chunk-4-1.pdf" title="plot of chunk unnamed-chunk-4" width="90%" type="application/pdf"></embed><p class="caption">
plot of chunk unnamed-chunk-4
</p>
</div>
<p>This plot compares observed vs. predicted mixing proportions for data
stream 2, helping you assess how well the model captures the underlying
signal.</p>
<hr>
</div>
<div class="section level3">
<h3 id="recap-using-mixmustr">Recap: Using mixmustr<a class="anchor" aria-label="anchor" href="#recap-using-mixmustr"></a>
</h3>
<p>Here’s a quick summary of how to use <code>mixmustr</code>
effectively:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Prepare Input Data</strong>:</p>
<ul>
<li>
<code>df_stream_1</code>: Observed data (optionally with group
labels)</li>
<li>
<code>df_stream_2</code>: Known mixing proportions (e.g., from
eDNA)</li>
</ul>
</li>
<li>
<p><strong>Define Tracer Summaries</strong>:</p>
<ul>
<li>
<code>mus</code>: Mean tracer values per source</li>
<li>
<code>sigmas</code>: Standard deviation per tracer per source</li>
</ul>
</li>
<li>
<p><strong>Run Model Configurations</strong>:</p>
<ul>
<li>Use <code><a href="../reference/run_mixmustr_models.html">run_mixmustr_models()</a></code> with the default or custom
configurations</li>
<li>Adjust Stan settings (iterations, chains, etc.) as needed</li>
</ul>
</li>
<li>
<p><strong>Visualize Results</strong>:</p>
<ul>
<li>Use <code><a href="../reference/make_post_prop_long.html">make_post_prop_long()</a></code> and plotting functions to
assess fit</li>
</ul>
</li>
</ol>
<hr>
</div>
<div class="section level3">
<h3 id="optional-custom-input-creation">Optional: Custom Input Creation<a class="anchor" aria-label="anchor" href="#optional-custom-input-creation"></a>
</h3>
<p>If you want more control, you can use
<code><a href="../reference/mixmustr_wrangle_input.html">mixmustr_wrangle_input()</a></code> directly to prepare the Stan input
list. This is helpful if you’re modifying the Stan code or working
outside the wrapper functions.</p>
<hr>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ul>
<li>Stock, B. C., Semmens, B. X. (2016). MixSIAR GUI User Manual. <a href="https://github.com/brianstock/MixSIAR" class="external-link">https://github.com/brianstock/MixSIAR</a>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Diego R. Barneche, Chritopher J. Fulton.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
